Basic Usage Examples
====================

This section provides basic usage examples for the ACFX package. These examples demonstrate how to initialize the ACFX class to generate counterfactual explanations.

Initializing ACFX
-----------------

To begin using ACFX, first import the class and create an instance.
For this example, let's pick AcfxEBM that requires ExplainableBoostingClassifier as its blackbox:

.. code-block:: python

    from acfx import AcfxEBM

    model = ExplainableBoostingClassifier()
    explainer = AcfxEBM(model)

Prepare the data
-----------------

Prepare some sample data for for counterfactual generation

.. code-block:: python

    from sklearn.datasets import load_iris
    def sample_data():
        data = load_iris(as_frame=True)
        X = data.data
        y = data.target
        return train_test_split(X, y, test_size=0.2, random_state=42)

        X_train, X_test, y_train, y_test = sample_data

Prepare bounds
------------------

Prepare bounds for data for counterfactual generation

.. code-block:: python

    pbounds = {col: (X_train[col].min(), X_train[col].max()) for col in X_train.columns}

Prepare adjacency matrix
--------------------------
Prepare example adjacency matrix for counterfactual generation. It can be expert knowledge or can be generated by tools like DirectLiNGAM

.. code-block:: python

    adjacency_matrix = np.array([
        [0.0, 0.0, 0.0, 0.0],
        [0.8, 0.0, 0.0, 0.0],
        [0.0, 0.6, 0.0, 0.0],
        [0.5, 0.0, 0.7, 0.0]
    ])

(Alternatively) prepare adjacency matrix using external tools
--------------------------
The adjacency matrix can be generated by tools like DirectLiNGAM

.. code-block:: python

    causal_model = lingam.DirectLiNGAM()
    causal_model.fit(dataset.df_train[dataset.features])

    adjacency_matrix = causal_model.adjacency_matrix_


Prepare the order of variables in the causal graph
--------------------------

.. code-block:: python

    causal_order = list(range(len(features_order)))

Fit to initialize the model
--------------------------

Initialize all the prepared data

.. code-block:: python

    features_order = X_train.columns.tolist()
    explainer.fit(X=X_train, query_instance=query_instance, adjacency_matrix=adjacency_matrix, casual_order=causal_order, pbounds=pbounds,
                  y=y_train, features_order=features_order)

Generate Counterfactuals
--------------------------

To generate counterfactual explanations for a given instance:

.. code-block:: python

    original_class = model.predict([query_instance])[0]

    cf = explainer.counterfactual(desired_class=original_class)
    print(counterfactuals)


Using custom blackbox
--------------------------

You can use ACFX with custom blackbox. To do so, you need to provide a optimizer that is compliant with the blackbox

#todo